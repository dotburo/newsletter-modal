/*! @dotburo/newsletter-modal 1.0.0 | dotburo <code@dotburo.org> (https://dotburo.org) !*/
var e={url:null,headers:{},fields:{firstname:!1,lastname:!1,email:!0,gdprCheckbox:!1,gdprNotice:!1},submitButtonText:"Submit",successMessage:"Success!"};const t=e=>`\n<div>\n    <input type="checkbox" id="nws-gdpr-check" name="nws_gdpr" required>\n    <label for="nws-gdpr-check">${e.label}</label>\n    <span class="invalid-feedback">${e.invalid||"This is required."}</span>\n</div>\n`,s=e=>e.url?`<a href="${e.url}" target="_blank" rel="noreferrer">${e.label}</a>`:e.text?`<a href="#" class="nws-gdpr-btn">${e.label} <span>ðŸ›ˆ</span></a>`:"",n=e=>`\n<div class="nws-flex-break"></div>\n<div class="nws-gdpr-txt">\n    <div class="nws-gdpr-txt-inner">${e.text}</div>\n</div>\n`,i=(e={})=>`\n<label class="${e.label?"":"sr-only"}">${e.label||"Email"}</label>\n<div class="input-group">\n    ${e.icon?d(e.icon):""}\n    <input type="email" name="nws_email" placeholder="Email" required autocomplete="email" class="form-control" value="a@a.com">\n    <div class="invalid-feedback">${e.invalid||"Please provide a valid email address."}</div>\n</div>\n`,l=(e={})=>`\n<label class="${e.label?"":"sr-only"}">${e.label||"First name"}</label>\n<div class="input-group">\n    ${e.icon?d(e.icon):""}\n    <input type="text" name="nws_first" placeholder="${e.placeholder||"First name"}" required class="form-control">\n    <div class="invalid-feedback">${e.invalid||"Please provide a valid first name."}</div>\n</div>\n`,a=(e={})=>`\n<label class="${e.label?"":"sr-only"}">${e.label||"Last name"}</label>\n<div class="input-group">\n    ${e.icon?d(e.icon):""}\n    <input type="text" name="nws_last" placeholder="${e.placeholder||"Last name"}" required class="form-control">\n    <div class="invalid-feedback">${e.invalid||"Please provide a valid last name."}</div>\n</div>\n`,d=e=>`\n<div class="input-group-prepend">\n  <div class="input-group-text ${e}"></div>\n</div>\n`,o=document,r={toggled:!1,classes:{toggled:"toggled"}};class c{constructor(e,t={}){this._options=t=Object.assign({},r,t),this._toggled=!1,this._events=[],this._el=this._setElement(e),t.toggled&&this.toggle(!0)}toggle(e){let t=this.getOptions("classes").toggled;return this._toggled=void 0!==e?e:!this._toggled,this._el.classList[this._toggled?"add":"remove"](t),this}on(e,t,s=null){return(s||this._el).addEventListener(e,t=t.bind(this),!0),this._events.push({name:e,fn:t,el:s}),this}getElement(e=""){return e?this._el.querySelector(e):this._el}hasElement(e){return!!this._el.querySelector(e)}getOptions(e=null){return e?this._options[e]:this._options}remove(){this._events=this._events.filter((e=>(e.el||this._el).removeEventListener(e.name,e.fn,!0))),this._el.parentNode.removeChild(this._el),this._el=null,this._options=r}_setElement(e){if(!e||!e.nodeType&&"string"!=typeof e)throw new Error("Wrong element type provided!");return e.nodeType?e:(this._options.parent||o).querySelector(e)}_trigger(e,t=null){let s;"function"==typeof CustomEvent?s=new CustomEvent(e,{detail:t,bubbles:!0,cancelable:!0}):(s=o.createEvent("CustomEvent"),s.initCustomEvent(e,!0,!0,t)),this._el.dispatchEvent(s)}}class h extends c{constructor(e,t={},s){super(e,t),this.validator=s,this._render()}static createElement(){const e=document.createElement("div");return e.className="nws-modal modal",e}_render(){var e;this.getElement().innerHTML=`\n<div class="modal-dialog modal-dialog-centered">\n    <form class="modal-content" action="/" method="POST">\n        <div class="modal-header">\n            <h5 class="modal-title">${(e=this.getOptions()).title?e.title:"Subscribe to our newsletter"}</h5>\n            <button type="button" class="close" data-dismiss="modal" aria-label="Close">\n              <span aria-hidden="true" style="pointer-events: none">&times;</span>\n            </button>\n        </div>\n        <div class="modal-body">\n${(e.fields.firstname?l(e.fields.firstname):"")+(e.fields.lastname?a(e.fields.lastname):"")+i(e.fields.email)+(e.fields.gdprCheckbox?t(e.fields.gdprCheckbox):"")}\n        </div>\n        <div class="modal-footer justify-content-between flex-wrap">\n            ${e.fields.gdprNotice?s(e.fields.gdprNotice):"<span></span>"}\n            <button type="submit" class="btn btn-primary nws-btn-submit">${e.submitButtonText}</button>\n            ${e.fields.gdprNotice?n(e.fields.gdprNotice):""}\n        </div>\n    </form>\n</div>\n`,document.body.appendChild(this.getElement()),this.toggle(!0),this.on("submit",this._handleSubmit).on("click",this._handleClose).on("keyup",this._handleClose,document.body),this.hasElement(".nws-gdpr-txt")&&this.on("click",this._toggleGdpr,this.getElement(".nws-gdpr-btn"))}_handleClose(e){const t=this.getOptions("classes").toggled,s=e.target.classList.contains(t),n=e.target.classList.contains("close"),i="Escape"===e.key;(s||i||n)&&(e.preventDefault(),this.toggle(!1))}_handleSubmit(e){e.preventDefault(),this._setLoading(!0);const t=this.getElement("form");this.validator.validate(t)?this._submit(this.validator.getData()).then((e=>{if(e.ok)return this._message(this.getOptions("successMessage"));throw new Error(e.statusText)})).catch((e=>{this._message(e.message)._setLoading(!1)})):this._setLoading(!1)}_submit(e){return window.fetch(this.getOptions("url"),{method:"POST",headers:Object.assign(this.getOptions("headers"),{"Content-Type":"application/json"}),body:JSON.stringify(e)})}_setLoading(e){const t=this.getElement(".nws-btn-submit");return t.innerHTML=e?"sending...":this.getOptions("submitButtonText"),this}_message(e){return this.getElement(".nws-msg").textContent=e,this}_toggleGdpr(){const e=this.getElement(".nws-gdpr-txt");e.classList.toggle("toggled")?e.style.height=e.firstElementChild.clientHeight+"px":e.style.height="0"}}class m{constructor(){this.validationMap={nws_email:this._validateEmail.bind(this),nws_gdpr:this._validateGdprCheck.bind(this),nws_first:this._validateName.bind(this),nws_last:this._validateName.bind(this)},this._data={}}validate(e){const t=e.elements;let s=!0;for(let e,n=0,i=t.length;n<i;n++)e=t.item(n),e.name&&(s=this.validationMap[e.name](e));return s}_validateEmail(e){const t=/^.*@.*..*/.test(e.value);return t&&this._setData(e.name,e.value),this._setElement(e,t),t}_validateName(e){const t=!e.value.match(/\d/g);return t&&this._setData(e.name,e.value),this._setElement(e,t),t}_validateGdprCheck(e){const t=e.checked;return t&&this._setData(e.name,!0),this._setElement(e,t),t}_setElement(e,t){e.classList[t?"remove":"add"]("is-invalid")}_setData(e,t){this._data[e]=t}getData(){return this._data}}let g=null;class u extends c{constructor(t,s={}){(s=Object.assign({},e,s)).fields=s.fields||{},s.classes=s.classes||{},s.classes.toggled="nws-toggled",super(t,s),this._render()}_render(){this.getElement().innerHTML=((e="Subscribe",t="")=>`\n<aside class="nws-cta">\n    ${t?`<h1>${t}</h1>`:""}\n    <button type="button" class="btn btn-primary">${e}</button>\n</aside>\n`)(),this.on("click",this._handleSubscribeButton)}_handleSubscribeButton(){g?g.toggle(!0):g=new h(h.createElement(),this.getOptions(),new m)}}export{u as default};
//# sourceMappingURL=NewsletterModal.js.map
